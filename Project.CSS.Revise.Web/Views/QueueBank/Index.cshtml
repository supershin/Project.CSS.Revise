@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_LayoutSite.cshtml";
    var buList = ViewBag.listBu as IEnumerable<dynamic> ?? Enumerable.Empty<dynamic>();
    var ExpecttransferList = ViewBag.listExpecttransfer as IEnumerable<dynamic> ?? Enumerable.Empty<dynamic>();
    var UnitstatuscsList = ViewBag.listUnitstatuscs as IEnumerable<dynamic> ?? Enumerable.Empty<dynamic>();
}

<div class="container-fluid">
    <div class="page-title">
        <div class="row">
            <div class="col-6">
                <h4>Queue Bank</h4>
            </div>
            <div class="col-6">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="index.html">
                            <svg class="stroke-icon">
                                <use xlink:href="@Url.Content("~/assets/svg/icon-sprite.svg#stroke-home")"></use>
                            </svg>
                        </a>
                    </li>
                    <li class="breadcrumb-item">Queue</li>
                    <li class="breadcrumb-item active">Queue Bank</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <!-- Filters card -->
    <div class="card filter-card">
        <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Filters</h5>
            <button class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-1"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#fltCollapse"
                    aria-expanded="true"
                    aria-controls="fltCollapse">
                <i class="fa fa-chevron-up"></i>
            </button>
        </div>
        <div id="fltCollapse" class="collapse show">
            <div class="card-body">
                <div class="row g-3 filter-grid">
                    <div class="col-12 col-md-4">
                        <label for="ddl_BUG" class="form-label fw-bold">BUG</label>
                        <select id="ddl_BUG" class="form-control multi-select" multiple>
                            @foreach (var bu in buList)
                            {
                                var val = (bu.ID ?? bu.ValueInt ?? bu.Value ?? "").ToString();
                                var text = (bu.Name ?? bu.Text ?? "").ToString();
                                <option value="@val">@text</option>
                            }
                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label for="ddl_Project" class="form-label fw-bold">Project</label>
                        <select id="ddl_Project" class="form-control">

                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label for="ddl_UnitCode" class="form-label fw-bold">Unit Code</label>
                        <select id="ddl_UnitCode" class="form-control multi-select" multiple>

                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label for="ddl_CSResponsible" class="form-label fw-bold">CS Response</label>
                        <select id="ddl_CSResponsible" class="form-control multi-select" multiple>
                            <option value="E001">ศิรภัสสร สุขอร่าม</option>
                            <option value="E002">ณัฐพงศ์ อินทร์จันทร์</option>
                            <option value="E003">ธัญญา บุญญาวัชรินทร์</option>
                            <option value="E004">วรรณกร ศรีสุนทร</option>
                            <option value="E005">สุวภา ศรีศักดา</option>
                            <option value="E006">อรนุช บุญถนอม</option>
                            <option value="E007">ภัทร์ชนก อินทรสถิตย์</option>
                            <option value="E008">สุภาวดี ม่วงงาม</option>
                            <option value="E009">จิราภรณ์ ทองมาก</option>
                            <option value="E010">ธนภัทร วงศ์ชัย</option>
                            <option value="E011">พีรวิชญ์ โกศลวิจิตร</option>
                            <option value="E012">อัญชิสา ชาญชู</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label for="ddl_UnitStatusCS" class="form-label fw-bold">Unit Status</label>
                        <select id="ddl_UnitStatusCS" class="form-control" multiple>
                            @foreach (var et in UnitstatuscsList)
                            {
                                var val = (et.ValueInt ?? "").ToString();
                                var text = (et.Text ?? "").ToString();
                                <option value="@val">@text</option>
                            }
                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label for="ddl_ExpectTransferBy" class="form-label fw-bold">Expect Transfer By</label>
                        <select id="ddl_ExpectTransferBy" class="form-control multi-select" multiple>
                            @foreach (var et in ExpecttransferList)
                            {
                                var val = (et.ValueInt ?? "").ToString();
                                var text = (et.Text ?? "").ToString();
                                <option value="@val">@text</option>
                            }
                        </select>
                    </div>
                    <div class="col-12 col-md-4" id="filter-register-date">
                        <label for="txt_RegisterDate" class="form-label fw-bold">Register Date</label>
                        <div class="input-group">
                            <input type="date" id="txt_RegisterDateStart" class="form-control" placeholder="Start date">
                            -
                            <input type="date" id="txt_RegisterDateEnd" class="form-control" placeholder="End date">
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-end align-items-center gap-2 flex-nowrap footer-actions p-2">
                <button id="btnFilterCancel" type="button" class="btn btn-outline-secondary btn-sm" onclick="ClearFilter()">
                    <i class="fa fa-undo me-1"></i> Cancel
                </button>
                <button id="btnSearch" class="btn btn-primary btn-sm" type="button">
                    <i class="fa fa-search me-1"></i> Search
                </button>

            </div>
        </div>
    </div>

    <!-- Project Table card -->
    <div class="card filter-card">
        <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Project Table</h5>
            <button class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-1"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#fltCollapseTable"
                    aria-expanded="true"
                    aria-controls="fltCollapseTable">
                <i class="fa fa-chevron-up"></i>
            </button>
        </div>
        <div id="fltCollapseTable" class="collapse show">
            <div class="card-body">
                <div class="project-table-card">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h5 class="mb-0">เคฟ ทาวน์ ไอส์แลนด์</h5>
                        <button class="btn btn-success btn-sm" onclick="openCreateRegister()">
                            <i class="fa fa-plus me-1"></i> ลงทะเบียน
                        </button>
                    </div>

                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover table-nowrap queue-table mb-0">
                                <thead>
                                    <tr>
                                        <th style="width:64px;">No.</th>
                                        <th style="width:140px;">Unit Code</th>
                                        <th class="customer-col">Customer Name</th>
                                        <th style="width:140px;">Appointment</th>
                                        <th style="width:160px;">Status</th>
                                        <th style="width:120px;">Time</th>
                                        <th style="width:120px;">Counter</th>
                                        <th style="width:170px;">Unit Status</th>
                                        <th style="width:170px;">CS Response</th>
                                        <th style="width:90px;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>A0201</td>
                                        <td class="customer-col">
                                            นางสมถวิล อุณหศิริกุล, นายอนุรักษ์ อุณหศิริกุล, นางสาวฐิตาภร อุณหศิริกุล, นางสาวปิยฉัตร อุณหศิริกุล
                                            <span class="svc-badges">
                                                <span class="svc svc-blue" data-title="Register FinPlus">R</span>
                                                <span class="svc svc-orange" data-title="Summit Bank">B</span>
                                                <span class="svc svc-green" data-title="WiseConnect">
                                                    <i class="fa fa-comment"></i>
                                                </span>
                                            </span>
                                        </td>
                                        <td>
                                         Y
                                        </td>
                                        <td>
                                            Register
                                        </td>
                                        <td>14:07</td>
                                        <td>
                                         1
                                        </td>
                                        <td>โอนแล้ว</td>
                                        <td>นางสาวสุนิสา สุขสันต์</td>
                                        <td class="text-end">
                                            <button class="btn btn-icon btn-del" title="Delete"><i class="fa fa-trash"></i></button>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>2</td>
                                        <td>A0202</td>
                                        <td>
                                            นางสาวการดี มีสุข
                                            <span class="svc-badges">
                                                <span class="svc svc-blue" data-title="Register FinPlus">R</span>
                                                <span class="svc svc-orange" data-title="Summit Bank">B</span>
                                                <span class="svc svc-green" data-title="Add Line WiseConnect">
                                                    <i class="fa fa-comment"></i>
                                                </span>
                                            </span>
                                        </td>
                                        <td><span class="appt appt-no"><i class="fa fa-times"></i></span></td>
                                        <td><span class="status-pill status-reg">Register</span></td>
                                        <td>14:08</td>
                                        <td><span class="counter-dot">2</span></td>
                                        <td>โอนแล้ว</td>
                                        <td>นางสาวสุนิสา สุขสันต์</td>
                                        <td class="text-end">
                                            <button class="btn btn-icon btn-del" title="Delete"><i class="fa fa-trash"></i></button>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>3</td>
                                        <td>A1021</td>
                                        <td>
                                            นายณวิช พาณิชย์
                                            <span class="svc-badges">
                                                <span class="svc svc-blue" data-title="Register FinPlus">R</span>
                                                <span class="svc svc-orange" data-title="Summit Bank">B</span>
                                            </span>
                                        </td>
                                        <td><span class="appt appt-ok"><i class="fa fa-check"></i></span></td>
                                        <td><span class="status-pill status-proc">In Process</span></td>
                                        <td>14:09</td>
                                        <td><span class="counter-dot">3</span></td>
                                        <td>โอนแล้ว</td>
                                        <td>นางสาวสุนิสา สุขสันต์</td>
                                        <td class="text-end">
                                            <button class="btn btn-icon btn-del" title="Delete"><i class="fa fa-trash"></i></button>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>4</td>
                                        <td>A2001</td>
                                        <td>
                                            นายศิราชัย มั่งมี
                                            <span class="svc-badges">
                                                <span class="svc svc-blue" data-title="Register FinPlus">R</span>
                                                <span class="svc svc-orange" data-title="Summit Bank">B</span>
                                            </span>
                                        </td>
                                        <td><span class="appt appt-no"><i class="fa fa-times"></i></span></td>
                                        <td><span class="status-pill status-proc">In Process</span></td>
                                        <td>14:10</td>
                                        <td><span class="counter-dot">4</span></td>
                                        <td>โอนแล้ว</td>
                                        <td>นางสาวสุนิสา สุขสันต์</td>
                                        <td class="text-end">
                                            <button class="btn btn-icon btn-del" title="Delete"><i class="fa fa-trash"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card-footer d-flex justify-content-between align-items-center">
                        <small class="text-muted">Showing 1 to 6 of 6 entries</small>
                        <ul class="pagination pagination-sm mb-0">
                            <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item"><a class="page-link" href="#">Next</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Register card -->
    <div class="card filter-card">
        <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Summary Register</h5>
            <button class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-1"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#fltCollapseSummaryRegister"
                    aria-expanded="true"
                    aria-controls="fltCollapseSummaryRegister">
                <i class="fa fa-chevron-up"></i>
            </button>
        </div>
        <div id="fltCollapseSummaryRegister" class="collapse show">
            <div class="card-body">
                <div class="summary-register">
                    <h5 class="mb-4">Summary Register Data As Of 2025-09-15</h5>

                    <!-- Top Row -->
                    <div class="summary-row">
                        <div class="summary-box bg-green">
                            <h6>Register</h6>
                            <div class="summary-values">
                                <div><strong>4</strong><br>Unit</div>
                                <div><strong>59.76 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">100%</div>
                        </div>

                        <div class="summary-box bg-blue">
                            <h6>Queue</h6>
                            <div class="summary-values">
                                <div><strong>2</strong><br>Unit</div>
                                <div><strong>29.40 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">50%</div>
                        </div>

                        <div class="summary-box bg-orange">
                            <h6>In Process</h6>
                            <div class="summary-values">
                                <div><strong>1</strong><br>Unit</div>
                                <div><strong>15.50 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">25%</div>
                        </div>

                        <div class="summary-box bg-green-light">
                            <h6>Done</h6>
                            <div class="summary-values">
                                <div><strong>1</strong><br>Unit</div>
                                <div><strong>14.86 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">25%</div>
                        </div>
                    </div>

                    <!-- Second Row -->
                    <div class="summary-row mt-3">
                        <div class="summary-box bg-green-light">
                            <h6>ยื่น</h6>
                            <div class="summary-values">
                                <div><strong>1</strong><br>Unit</div>
                                <div><strong>14.86 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">50%</div>
                        </div>

                        <div class="summary-box bg-pink-soft">
                            <h6>ไม่ยื่น</h6>
                            <div class="summary-values">
                                <div><strong>1</strong><br>Unit</div>
                                <div><strong>14.60 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">50%</div>
                        </div>

                        <div class="summary-box bg-pink">
                            <h6>อาชีพอิสระ</h6>
                            <div class="summary-values">
                                <div><strong>2</strong><br>Unit</div>
                                <div><strong>29.40 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">50%</div>
                        </div>

                        <div class="summary-box bg-pink">
                            <h6>รายได้ประจำ</h6>
                            <div class="summary-values">
                                <div><strong>1</strong><br>Unit</div>
                                <div><strong>15.50 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">25%</div>
                        </div>

                        <div class="summary-box bg-pink">
                            <h6>เจ้าของกิจการ</h6>
                            <div class="summary-values">
                                <div><strong>1</strong><br>Unit</div>
                                <div><strong>14.86 M</strong><br>Value</div>
                            </div>
                            <div class="summary-footer">25%</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!--  Summary Bank card -->
    <div class="card filter-card">
        <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Summary Bank</h5>
            <button class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-1"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#fltCollapseSummaryBank"
                    aria-expanded="true"
                    aria-controls="fltCollapseSummaryBank">
                <i class="fa fa-chevron-up"></i>
            </button>
        </div>
        <div id="fltCollapseSummaryBank" class="collapse show">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered align-middle summary-bank-table">
                        <thead>
                            <tr>
                                <th style="width: 340px;">ธนาคาร</th>
                                <th style="width: 160px;">อัตราดอกเบี้ยเฉลี่ย 3 ปี</th>
                                <th style="width: 120px;">จำนวน</th>
                                <th style="width: 160px;">มูลค่า</th>
                                <th style="width: 100px;">%</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <img src="~/image/ThaiBankicon/BBL.png" alt="BBL" class="bank-logo">
                                        <span>ธนาคารกรุงเทพ จำกัด (มหาชน)</span>
                                    </div>
                                </td>
                                <td>2.99</td>
                                <td>2</td>
                                <td>29.40 M</td>
                                <td>50%</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <img src="~/image/ThaiBankicon/KBT.png" alt="KBank" class="bank-logo">
                                        <span>ธนาคารกสิกรไทย จำกัด (มหาชน)</span>
                                    </div>
                                </td>
                                <td>1.90</td>
                                <td>1</td>
                                <td>15.50 M</td>
                                <td>25%</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <img src="~/image/ThaiBankicon/SCB.png" alt="SCB" class="bank-logo">
                                        <span>ธนาคารไทยพาณิชย์ จำกัด (มหาชน)</span>
                                    </div>
                                </td>
                                <td>1.45</td>
                                <td>1</td>
                                <td>14.86 M</td>
                                <td>25%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

<div class="container-fluid mb-3">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">

        <!-- Left: Back Button -->
        <button id="btnBack" class="btn d-flex align-items-center gap-1">
            <i class="fa fa-arrow-left"></i> Back
        </button>

        <!-- Right: Action Buttons -->
        <div class="d-flex align-items-center gap-2 flex-wrap">
            <!-- Export (Excel) -->
            <button id="btnExport" class="btn d-flex align-items-center gap-1">
                <i class="fa fa-file-excel-o" aria-hidden="true"></i> Export
            </button>

            <!-- Customer View (Desktop) -->
            <button id="btnCustomerView" class="btn btn-success d-flex align-items-center gap-1">
                <i class="fa fa-desktop"></i> Customer View
            </button>

            <!-- Counter (Bookmark) -->
            <button id="btnCounter" class="btn d-flex align-items-center gap-1">
                <i class="fa fa-bookmark"></i> Counter
            </button>
        </div>

    </div>
</div>

<!-- Modal: Create Register -->
<div class="modal fade" id="modalCreateRegister" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content" id="cr-modal">

            <!-- Header -->
            <div class="modal-header cr-header">
                <h5 class="modal-title">Create Register</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Body -->
            <div class="modal-body">
                <!-- Unit Code + Save -->
                <div class="row justify-content-center align-items-center g-2 mb-3">
                    <div class="col-auto">
                        <label for="crUnitCode" class="col-form-label fw-semibold">Unit Code <span class="text-danger">*</span></label>
                    </div>
                    <div class="col-12 col-md-5">
                        <div class="input-group cr-input">
                            <input id="crUnitCode" type="text" class="form-control" placeholder="A0201" />
                            <span class="input-group-text"><i class="fa fa-search"></i></span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <button id="crBtnSave" class="btn btn-success">
                            <i class="fa fa-check me-1"></i> Save
                        </button>
                    </div>
                </div>

                <!-- Table -->
                <div class="table-responsive">
                    <table class="table table-sm table-hover mb-0 cr-table" id="crTable">
                        <thead>
                            <tr>
                                <th style="width:64px;">No.</th>
                                <th style="width:120px;">Unit Code</th>
                                <th>Customer Name</th>
                                <th style="width:180px;">Responsible Name</th>
                                <th style="width:150px;">Register</th>
                                <th style="width:120px;">Wait</th>
                                <th style="width:150px;">In Process</th>
                                <th style="width:120px;">FastFix</th>
                                <th style="width:140px;">FixedDuration</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>26/5</td>
                                <td>นายกานต์ ณรงค์เดชา, นางสาวอภัสรา วชิรพรหม</td>
                                <td>พรฉิม</td>
                                <td>2025-09-15 14:22</td>
                                <td></td>
                                <td>2025-09-15 13:45</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>26/4</td>
                                <td>นายภาณุทัศน์ สุทธิยะรักษ์</td>
                                <td>พรฉิม</td>
                                <td>2025-09-15 13:18</td>
                                <td></td>
                                <td>2025-09-15 13:44</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>26/3</td>
                                <td>นางอนุพภ กนล</td>
                                <td>พรฉิม</td>
                                <td>2025-09-15 13:18</td>
                                <td></td>
                                <td>2025-09-15 13:17</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>26/2</td>
                                <td>นางศิวโรจน์ จิตถนิมมาลย์เชษฐ์</td>
                                <td>พรฉิม</td>
                                <td>2025-09-15 13:17</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>26/1</td>
                                <td>นายชูดุ ศิริวงศ์ดี</td>
                                <td>Pimmada</td>
                                <td>2025-09-15 13:12</td>
                                <td></td>
                                <td>2025-09-15 13:16</td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-light cr-cancel" data-bs-dismiss="modal">Cancel</button>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        const customerViewUrl = '@Url.Action("Index", "QueueBankCustomerView")';
        const QueueBankCheckerViewUrl = '@Url.Action("Index", "QueueBankCheckerView")';
    </script>

    <script src="~/js/Pages/QueueBank/QueueBank.js?ver=@DateTime.Now.Ticks.ToString()"></script>
    <link rel="stylesheet" type="text/css" href="~/css/queuebank.css?ver=@DateTime.Now.Ticks.ToString()">
}