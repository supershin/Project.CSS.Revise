@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_LayoutSite.cshtml";
    // @model List<Project.CSS.Revise.Web.Models.Pages.CSResponse.GetlistCountByCS>
}
<style>
    .no-select {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    #csChildModal {
        z-index: 9999 !important;
    }

        /* Make the table's wrapper the scroll container */
        #csChildModal .table-responsive {
            /* adjust height to taste */
            max-height: calc(100vh - 160px);
            overflow: auto; /* both directions */
        }

        /* Sticky header */
        #csChildModal .status-table thead th {
            position: sticky;
            top: 0; /* pin to top of the scrolling area */
            z-index: 3; /* above body cells */
            background: var(--bs-secondary-bg, #f8f9fa);
        }

        /* Optional: subtle divider under header */
        #csChildModal .status-table thead tr {
            box-shadow: 0 2px 0 rgba(0,0,0,.06);
        }

    #div_Tb_CS_Response {
        max-height: 550px; /* you already have this inline; moving here is cleaner */
        overflow: auto; /* vertical + horizontal */
    }

        /* Sticky table header */
        #div_Tb_CS_Response thead th {
            position: sticky;
            top: 0; /* pin to the top of the scroll container */
            z-index: 3; /* above body cells */
            background: var(--bs-light, #f8f9fa); /* keep background when overlapping */
            background-clip: padding-box; /* avoid border bleed */
            box-shadow: 0 2px 0 rgba(0,0,0,.06); /* subtle divider */
        }

</style>
<div class="container-fluid">
    <div class="page-title">
        <div class="row">
            <div class="col-6">
                <h4>CS Response</h4>
            </div>
            <div class="col-6">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="index.html">
                            <svg class="stroke-icon">
                                <use xlink:href="@Url.Content("~/assets/svg/icon-sprite.svg#stroke-home")"></use>
                            </svg>
                        </a>
                    </li>
                    <li class="breadcrumb-item">Setting</li>
                    <li class="breadcrumb-item active">CS Response</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<div id="secure-area" oncontextmenu="return false;" class="no-select">
<div class="container-fluid">
        <div class="box-col-12">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <ul class="simple-wrapper nav nav-tabs" id="Other-Settings-Tab-filter" role="tablist">
                            <li class="nav-item"><a class="nav-link active txt-primary" id="counter-tab" data-bs-toggle="tab" href="#counter-filter" role="tab" aria-controls="counter-tab" aria-selected="true"><i class="icofont icofont-building"></i>Unit</a></li>
                            <li class="nav-item"><a class="nav-link txt-primary" id="shop-event-tab" data-bs-toggle="tab" href="#shop-event-filter" role="tab" aria-controls="shop-event-tab" aria-selected="false"><i class="icofont icofont-man-in-glasses"></i>CS</a></li>
                        </ul>
                        <div class="tab-content" id="Other-Settings-Tab-filter-Content">
                            <div class="tab-pane fade show active" id="counter-filter" role="tabpanel" aria-labelledby="counter-tab">
                                <div class="p-3">
                                    <div class="row mb-3">
                                    <div class="col-xl-3 xl-30 box-col-12"> @* card 1 *@
                                        <div class="md-sidebar">
                                            <a class="btn btn-primary email-aside-toggle md-sidebar-toggle">Job filter</a>
                                            <div class="md-sidebar-aside job-sidebar">
                                                <div class="default-according style-1 faq-accordion job-accordion">
                                                    <div class="accordion" id="accordionExample">
                                                        <div class="card">
                                                            <div class="card-header" id="headingOne">
                                                                <h2 class="mb-0">
                                                                    <button class="btn btn-link btn-block text-start" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Filter</button>
                                                                </h2>
                                                            </div>
                                                            <div class="collapse show" id="collapseOne" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                                                <div class="card-body filter-cards-view animate-chk">
                                                                    <!-- 🔍 พนักงาน -->
                                                                    <div class="job-filter mb-3">
                                                                        <label for="csUserSelect" class="form-label fw-bold">ชื่อพนักงาน</label>
                                                                                @{
                                                                                    var csUsers = ViewBag.listAllCSUser as IEnumerable<dynamic> ?? Enumerable.Empty<dynamic>();
                                                                                }
                                                                                <select id="csUserSelect" class="form-control searchable-select">
                                                                                    @foreach (var u in csUsers)
                                                                                    {
                                                                                        var val = (u.ValueString ?? u.ValueInt ?? u.Value ?? u.ID ?? "").ToString();
                                                                                        var text = (u.Text ?? u.FullName ?? u.Name ?? "").ToString();
                                                                                        <option value="@val">@text</option>
                                                                                    }
                                                                                </select>
                                                                    </div>
                                                                    <div class="job-filter mb-3">
                                                                        <label for="csUserSelectview" class="form-label fw-bold">ประเภทการแสดง</label>
                                                                            <select id="csUserSelectview" class="form-control searchable-select">
                                                                                <option value="">ทั้งหมด</option>
                                                                                <option value="1">CS</option>
                                                                                <option value="2">Other</option>
                                                                            </select>
                                                                    </div>

                                                                    <!-- 🏢 โครงการ -->
                                                                    <div class="job-filter mb-3">
                                                                        <label for="projectSelect" class="form-label fw-bold">โครงการ</label>
                                                                            @{
                                                                                var _projects = ViewBag.listDDlAllProject as IEnumerable<dynamic> ?? Enumerable.Empty<dynamic>();
                                                                            }
                                                                            <select id="projectSelect" class="form-control searchable-select">
                                                                                    @foreach (var p in _projects)
                                                                                {
                                                                                    var val = (p.ValueString ?? p.ValueInt ?? p.Value ?? p.ID ?? "").ToString();
                                                                                    var text = (p.Text ?? p.ProjectName ?? p.Name ?? "").ToString();
                                                                                    <option value="@val">@text</option>
                                                                                }
                                                                            </select>
                                                                    </div>

                                                                    <div class="job-filter mb-3">
                                                                        <label for="ddlUnitStatus" class="form-label fw-bold">Unit Status (CRM)</label>
                                                                        <select id="ddlUnitStatus" class="form-select" multiple>
                                                                                <option value="1">ว่าง</option>
                                                                                <option value="2">จอง</option>
                                                                                <option value="3">สัญญา</option>
                                                                                <option value="4">โอน</option>
                                                                        </select>
                                                                    </div>

                                                                    <!-- 🏢 อาคาร -->
                                                                    <div class="job-filter mb-3">
                                                                                <label for="buildingMultiSelect" class="form-label fw-bold">อาคาร/โซน</label>
                                                                        <select id="buildingMultiSelect" class="form-control multi-select" multiple>
      
                                                                        </select>
                                                                    </div>

                                                                    <!-- 🧱 ชั้น -->
                                                                    <div class="job-filter mb-3">
                                                                        <label for="floorMultiSelect" class="form-label fw-bold">ชั้น</label>
                                                                        <select id="floorMultiSelect" class="form-control multi-select" multiple>

                                                                        </select>
                                                                    </div>

                                                                    <!-- 🚪 ห้อง -->
                                                                    <div class="job-filter mb-3">
                                                                        <label for="roomMultiSelect" class="form-label fw-bold">Unit</label>
                                                                        <select id="roomMultiSelect" class="form-control multi-select" multiple>

                                                                        </select>
                                                                    </div>

                                                                    <!-- 🔎 ปุ่มค้นหา -->
                                                                    <button id="btnSearch" class="btn btn-primary text-center" type="button">Search 🔍</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-9 xl-70 box-col-12"> 
                                        <div class="card">
                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h4 id="name_project_selected"></h4>
                                                    <small id="row_count" class="text-muted"></small>
                                                </div>
                                                <div>
                                                    <button type="button" class="btn btn-primary btn-sm" id="save_change_cs_responsive">
                                                        💾 Save
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                        <div class="table-responsive" id="div_Tb_CS_Response">
                                                            <table class="table table-bordered table-striped align-middle text-center" id="Tb_CS_Response">
                                                                <thead class="table-light">
                                                                    <tr>
                                                                        <th class="text-center">
                                                                            <input class="form-check-input" type="checkbox" id="checkAll">
                                                                        </th>
                                                                        <th>Unit</th>
                                                                        <th>CS Name</th>
                                                                        <th>Update</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="Tb_CS_Response_body"></tbody>
                                                            </table>
                                                        </div>

                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="shop-event-filter" role="tabpanel" aria-labelledby="shop-event-tab">
                                <div class="p-3">
                                    <div class="row mb-3">
                                            <div class="col-12">
                                                <div class="card mb-3">
                                                    <div class="card-body">
                                                        <div class="row g-2 align-items-center">
                                                            <div class="col-md-3">
                                                                <label for="ddlBU_cs" class="form-label fw-bold">Business Unit</label>
                                                                <select id="ddlBU_cs" class="form-select">
                                                                    <option value="">-- All BU --</option>
                                                                    @foreach (var bu in ViewBag.listBu2 ?? new List<dynamic>())
                                                                    {
                                                                        <option value="@bu.ID">@bu.Name</option>
                                                                    }
                                                                </select>
                                                            </div>

                                                            <div class="col-md-3">
                                                                <label for="ddlProject_cs" class="form-label fw-bold">โครงการ</label>
                                                                <select id="ddlProject_cs" class="form-select" multiple></select>
                                                            </div>

                                                            <div class="col-md-4">
                                                                <label for="txtCsName_cs" class="form-label fw-bold">ค้นหา CS</label>
                                                                <input type="text" id="txtCsName_cs" class="form-control" placeholder="พิมพ์ชื่อ, Email, Mobile">
                                                            </div>

                                                            <div class="col-md-2">
                                                                <div class="d-grid" style="margin-top:25px;">
                                                                    <button id="btnSearch_cs" class="btn btn-primary w-100">
                                                                        <i class="bi bi-search me-1"></i> ค้นหา
                                                                    </button>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm align-middle" id="tbCSSummary">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th style="width:36px;"></th>
                                                                <th>User (TH / EN)</th>
                                                                <th>Email</th>
                                                                <th>Mobile</th>
                                                                <th class="text-end">Project / Unit</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="tbCSSummaryBody">
                                                            <!-- JS render -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                                    </div>
                                                </div>
                                            </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- CS Child Modal -->
<div class="modal fade" id="csChildModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="csChildModalTitle" class="modal-title">รายละเอียดโครงการ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิด"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-sm mb-0 status-table">
                        <thead id="csChildModalThead"></thead>
                        <tbody id="csChildModalTbody"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <small class="text-muted me-auto">เลื่อนขวาเพื่อดูสถานะทั้งหมด</small>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <link rel="stylesheet" type="text/css" href="~/css/csresponse.css?ver=@DateTime.Now.Ticks.ToString()">
    <script src="~/js/Pages/CSResponse/index.js?ver=@DateTime.Now.Ticks.ToString()"></script>
}