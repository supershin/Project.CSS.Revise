@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_LayoutSite.cshtml";
}

<div class="container-fluid">
    <div class="page-title">
        <div class="row">
            <div class="col-6">
                <h4>User Bank</h4>
            </div>
            <div class="col-6">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="index.html">
                            <svg class="stroke-icon">
                                <use xlink:href="@Url.Content("~/assets/svg/icon-sprite.svg#stroke-home")"></use>
                            </svg>
                        </a>
                    </li>
                    <li class="breadcrumb-item">Setting</li>
                    <li class="breadcrumb-item active">User Bank</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<!-- Container-fluid starts-->
<div class="container-fluid">
    <div class="email-wrap bookmark-wrap">
        <div class="row">
            <div class="box-col-12">
                <div class="email-right-aside bookmark-tabcontent contacts-tabs">
                    <div class="card email-body radius-left dark-contact">
                        <div class="ps-0">
                            <div class="tab-content">
                                <div class="tab-pane fade active show" id="pills-personal" role="tabpanel" aria-labelledby="pills-personal-tab">
                                    <div class="card">
                                        <div class="card-header d-flex flex-wrap justify-content-between align-items-center gap-2">
                                            <!-- Search box -->
                                            <div class="flex-grow-1">
                                                <input type="text"
                                                       id="searchPerson"
                                                       class="form-control"
                                                       placeholder="🔍 ค้นหา ชื่อ,นามสกุล">
                                            </div>

                                            <!-- Bank dropdown (ใช้ listBank: ValueInt, Text) -->
                                            <div style="min-width:220px;">
                                                <select id="ddl_bank" class="form-select" multiple>
                                                    <option value="">— เลือกธนาคาร —</option>
                                                </select>
                                            </div>

                                            <button type="button" id="btnSearchUser" class="btn btn-outline-secondary btn-sm ms-2">
                                                <i class="fa fa-search me-1"></i> Search
                                            </button>

                                            <!-- Create button -->
                                            <button type="button" class="btn btn-primary btn-sm ms-2" onclick="openAddUserBankModal()">
                                                <i class="bi bi-plus-circle me-1"></i> Create
                                            </button>

                                        </div>

                                        <div class="card-body">
                                           <div class="row list-persons" id="addcon">
    
    <div class="col-xl-12 p-3">
        <div id="bankCountCards" class="row g-3"></div>
        <div class="d-none"> <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                <div class="card bank-card p-3 text-center cursor-pointer"
                        onclick="prepareInterestModal('1', 'ธนาคารกรุงเทพ', '1.50')">
                    <div class="mb-2">
                        <img src="/assets/bank/bbl.png" style="width:48px;height:48px;">
                    </div>
                    <div class="fw-semibold">ธนาคารกรุงเทพ</div>
                    <small class="text-muted">Users: 11</small>
                    <div class="text-success small mt-1">
                        <i class="fa fa-percent"></i> 1.50
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4 xl-40 col-md-5">
        <div class="vertical-scroll scroll-demo scroll-b-none"
             style="height: 911px; overflow-y: auto; overflow-x: hidden;">
            <div id="userBankList" class="list-group">
                </div>
        </div>
    </div>

    <div class="col-xl-8 xl-60 col-md-7">
        <div class="card h-100">
            <div class="card-header bg-white border-0 pb-0">
                <div class="d-flex align-items-center gap-3">
                    <div class="bank-logo-circle">
                        <img id="editUserBankLogo" src="" alt="Bank" />
                    </div>
                    <div>
                        <div id="editUserBankFullName" class="fw-bold text-dark fs-5"></div>
                        <div id="editUserBankBankName" class="text-muted"></div>
                    </div>
                </div>
                <hr class="mt-3 mb-0" />
            </div>

            <div class="card-body pt-3">
                <ul class="simple-wrapper nav nav-tabs" id="Edit-userbank-Form-tab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active txt-primary" id="detail-tab" data-bs-toggle="tab"
                           href="#detail-filter" role="tab" aria-controls="detail-tab" aria-selected="true">
                            <i class="fa fa-user me-1"></i> Detail
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link txt-primary" id="team-tab" data-bs-toggle="tab"
                           href="#team-filter" role="tab" aria-controls="team-tab" aria-selected="false">
                            <i class="fa fa-users me-1"></i> Team
                        </a>
                    </li>
                </ul>

                <div class="tab-content" id="Edit-userbank-Form-tab-Content">
                    
                    <div class="tab-pane fade show active" id="detail-filter" role="tabpanel" aria-labelledby="detail-tab">
                        <div class="profile-mail pt-3">
                            
                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">หัวหน้า Team</label>
                                <div class="col-sm-9 d-flex align-items-center">
                                    <input type="checkbox" id="chkIsLead" class="form-check-input me-2" />
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">Bank</label>
                                <div class="col-sm-9">
                                    <select id="ddlEditBank" class="form-select"></select>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">Team Name</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="inpParentTeam" type="text" disabled>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">First Name</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="inpFirstName" type="text" placeholder="First name">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">Last Name</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="inpLastName" type="text" placeholder="Last name">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">Mobile</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="inpMobile" type="tel" placeholder="0812345678">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">Email</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="inpEmail" type="email" placeholder="example@mail.com">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">Username</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="inpUsername" type="text" placeholder="username">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">Password</label>
                                <div class="col-sm-9">
                                    <input class="form-control" id="inpPassword" type="password" placeholder="********">
                                </div>
                            </div>

                            <div class="mb-3">
                                <select id="projectMultiSelect" class="form-control" multiple></select>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-sm-3 col-form-label">Area</label>
                                <div class="col-sm-9">
                                    @{
                                        var areas = ViewBag.ListArea as IEnumerable<dynamic> ?? Enumerable.Empty<dynamic>();
                                    }
                                    @foreach (var a in areas)
                                    {
                                        var val = (a.ValueInt ?? a.ValueString ?? a.Value ?? a.ID ?? "").ToString();
                                        var text = (a.Text ?? a.Name ?? "").ToString();
                                        var cid = $"area_{val}";
                                        <div class="form-check form-check-inline mb-2">
                                            <input class="form-check-input"
                                                   type="checkbox"
                                                   id="@cid"
                                                   name="AreaIDs"
                                                   value="@val" />
                                            <label class="form-check-label" for="@cid">@text</label>
                                        </div>
                                    }
                                </div>
                            </div>

                            <div class="mb-2 d-flex justify-content-between align-items-center bg-white">
                                <button id="btnDeleteUserBank" type="button" class="btn btn-outline-danger">
                                    <i class="fa fa-trash me-1"></i> Delete
                                </button>
                                <button id="btnSaveUserBank" type="button" class="btn btn-primary">
                                    <i class="fa fa-save me-1"></i> Save
                                </button>
                            </div>

                        </div>
                    </div>

                    <div class="tab-pane fade" id="team-filter" role="tabpanel" aria-labelledby="team-tab">
                        <div class="pt-3">
                            <div class="mb-3">
                                <label class="form-label fw-semibold mb-1">Teams Name</label>
                                <input type="text" class="form-control" id="inpTeamName" disabled>
                            </div>

                            <div class="mb-3">
                                <div class="row">
                                    <div class="col-8">
                                        <select class="form-select" aria-label="เลือกสมาชิกเข้าทีม" id="ddl-add-more-user-bank">
                                            <option value="">เลือกสมาชิกเข้าทีม</option>
                                        </select>
                                    </div>
                                    <div class="col-4">
                                        <button class="btn btn-outline-primary" type="button" id="crewDropdown">
                                            <i class="fa fa-user-plus me-1"></i> Add crew
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0">
                                        <i class="fa fa-search text-muted"></i>
                                    </span>
                                    <input id="inpSearchTeam" type="text" class="form-control border-start-0" placeholder="ค้นหา Full name / Email / Mobile / Area">
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table align-middle" id="tblTeam">
                                    <thead>
                                        <tr class="border-bottom">
                                            <th class="text-muted fw-semibold">Member</th>
                                            <th class="text-muted fw-semibold">Area</th>
                                            <th style="width:100px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="teamTbody">
                                        </tbody>
                                    <tfoot>
                                        <tr class="border-top">
                                            <td colspan="4" class="small text-muted">
                                                * กดปุ่ม Remove เพื่อลบออกจากทีม
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                        </div>
                    </div>

                </div> </div> </div> </div> </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- Container-fluid Ends-->

<!-- Insert New User Bank -->
<div class="modal fade" id="modalAddUserBank" tabindex="-1" aria-labelledby="modalAddUserBankLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header border-0 pb-0">
                <div>
                    <h5 class="modal-title fw-bold" id="modalAddUserBankLabel">Create User Bank</h5>
                    <div class="text-muted small">เพิ่มผู้ใช้ธนาคารใหม่ และเลือกโปรเจ็กต์ที่เกี่ยวข้อง</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body pt-3">
                <form id="formAddUserBank" class="row g-3">

                    <!-- หัวหน้า Team -->
                    <div class="col-12 d-flex align-items-center gap-2">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="addIsLeadBank">
                            <label class="form-check-label" for="addIsLeadBank">หัวหน้า Team</label>
                        </div>
                    </div>

                    <!-- Bank -->
                    <div class="col-12 col-md-6">
                        <label class="form-label">Bank <span class="text-danger">*</span></label>
                        <select id="ddlAddBank" class="form-select" required></select>
                        <div class="invalid-feedback">กรุณาเลือกธนาคาร</div>
                    </div>

                    <!-- Projects (multi-select) -->
                    <div class="col-12 col-md-6">
                        <label class="form-label">Projects</label>
                        <select id="ddlAddProjects" class="form-control" multiple></select>
                    </div>

                    <!-- First / Last Name -->
                    <div class="col-12 col-md-6">
                        <label class="form-label">First Name <span class="text-danger">*</span></label>
                        <input id="addFirstName" type="text" class="form-control" placeholder="ชื่อ" required>
                        <div class="invalid-feedback">กรุณากรอกชื่อ</div>
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Last Name <span class="text-danger">*</span></label>
                        <input id="addLastName" type="text" class="form-control" placeholder="นามสกุล" required>
                        <div class="invalid-feedback">กรุณากรอกนามสกุล</div>
                    </div>

                    <!-- Mobile / Email -->
                    <div class="col-12 col-md-6">
                        <label class="form-label">Mobile</label>
                        <input id="addMobile" type="tel" class="form-control" placeholder="0812345678" inputmode="numeric">
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Email</label>
                        <input id="addEmail" type="email" class="form-control" placeholder="example@mail.com">
                    </div>

                    <!-- Username / Password -->
                    <div class="col-12 col-md-6">
                        <label class="form-label">Username <span class="text-danger">*</span></label>
                        <input id="addUsername" type="text" class="form-control" placeholder="username" required>
                        <div class="invalid-feedback">กรุณากรอก Username</div>
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Password <span class="text-danger">*</span></label>
                        <div class="position-relative">
                            <input id="addPassword" type="password" class="form-control pe-5" placeholder="********" required>
                            <button type="button" class="btn btn-link position-absolute top-50 end-0 translate-middle-y me-2 text-decoration-none" id="btnToggleAddPw">show</button>
                        </div>
                        <div class="invalid-feedback">กรุณากรอกรหัสผ่าน</div>
                    </div>

                    <!-- Area -->
                    @{
                        var areas = ViewBag.ListArea as IEnumerable<dynamic> ?? Enumerable.Empty<dynamic>();
                    }

                    <div class="col-12">
                        <label class="form-label">Area</label>
                        <div class="d-flex gap-3 mt-1 flex-wrap">
                            @foreach (var a in areas)
                            {
                                var val = (a.ValueInt ?? a.ValueString ?? a.Value ?? a.ID ?? "").ToString();
                                var text = (a.Text ?? a.Name ?? "").ToString();
                                var cid = $"addArea_{val}";
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="addArea" id="@cid" value="@val" />
                                    <label class="form-check-label" for="@cid">@text</label>
                                </div>
                            }
                        </div>
                    </div>


                </form>
            </div>

            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="btnSaveNewUserBank" class="btn btn-primary">
                    <i class="fa fa-save me-1"></i> Save
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Modal Ends-->

<div class="modal fade" id="modalEditInterest" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header border-0 pb-0">
                <h6 class="modal-title fw-bold">แก้ไขดอกเบี้ย</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body pt-2">
                <form id="formEditInterest">
                    <div class="mb-3 text-center">
                        <div id="displayBankName" class="fw-bold text-primary fs-5 mb-1">
                            ธนาคาร...
                        </div>
                        <small class="text-muted">กำหนดอัตราดอกเบี้ยปัจจุบัน</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small fw-semibold">Interest Rate (%)</label>
                        <div class="input-group">
                            <input type="number" id="inpInterestRate" class="form-control text-center fs-5 fw-bold"
                                   placeholder="0.00" step="0.01" min="0">
                            <span class="input-group-text bg-light">%</span>
                        </div>
                    </div>

                    <input type="hidden" id="hddBankIdForInterest">

                    <div class="d-grid">
                        <button type="button" class="btn btn-primary" id="btnSaveInterest">บันทึก</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/Pages/UserBank/index.js?ver=@DateTime.Now.Ticks.ToString()"></script>
    <link rel="stylesheet" type="text/css" href="~/css/userbank.css?ver=@DateTime.Now.Ticks.ToString()">

}




